{{define "title"}}Dashboard{{end}}

{{define "head"}}{{end}}

{{define "content"}}

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            Total Uptime
        </div>
        <div class="stat-value">{{.GlobalUptimePct}}%</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
            </svg>
            Active URLs
        </div>
        <div class="stat-value">{{len .URLs}}</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/>
            </svg>
            Avg Response
        </div>
        <div class="stat-value">{{if .GlobalAvgLatency}}{{.GlobalAvgLatency}} ms{{else}}N/A{{end}}</div>
    </div>
</div>

<div class="card">
    <h2 class="card-title">
        <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/>
        </svg>
        Grafik Response Time
    </h2>
    
    <form action="/" method="GET" class="input-group" style="display:flex;gap:8px;align-items:center;">
        <select name="url_id" onchange="this.form.submit()">
            {{if not .URLs}}
                <option>There are no URLs to display</option>
            {{else}}
                {{range .URLs}}
                    <option value="{{.ID}}" {{if eq .ID $.SelectedURLID}}selected{{end}}>
                        {{.URL}}
                    </option>
                {{end}}
            {{end}}
        </select>
        <input type="hidden" name="range" id="chart_range_input" value="{{or $.ChartRange "1d"}}" />
        <div class="chart-range-group">
            <button type="button" class="chart-range-btn{{if eq (or $.ChartRange "1d") "10s"}} active{{end}}" onclick="document.getElementById('chart_range_input').value='10s'; this.form.submit();">10s</button>
            <button type="button" class="chart-range-btn{{if eq (or $.ChartRange "1d") "30s"}} active{{end}}" onclick="document.getElementById('chart_range_input').value='30s'; this.form.submit();">30s</button>
            <button type="button" class="chart-range-btn{{if eq (or $.ChartRange "1d") "1min"}} active{{end}}" onclick="document.getElementById('chart_range_input').value='1min'; this.form.submit();">1min</button>
            <button type="button" class="chart-range-btn{{if eq (or $.ChartRange "1d") "1h"}} active{{end}}" onclick="document.getElementById('chart_range_input').value='1h'; this.form.submit();">1h</button>
            <button type="button" class="chart-range-btn{{if eq (or $.ChartRange "1d") "4h"}} active{{end}}" onclick="document.getElementById('chart_range_input').value='4h'; this.form.submit();">4h</button>
            <button type="button" class="chart-range-btn{{if or (eq (or $.ChartRange "1d") "1d") (not $.ChartRange)}} active{{end}}" onclick="document.getElementById('chart_range_input').value='1d'; this.form.submit();">24h</button>
            <button type="button" class="chart-range-btn{{if eq (or $.ChartRange "1d") "1w"}} active{{end}}" onclick="document.getElementById('chart_range_input').value='1w'; this.form.submit();">1W</button>
            <button type="button" class="chart-range-btn{{if eq (or $.ChartRange "1d") "1m"}} active{{end}}" onclick="document.getElementById('chart_range_input').value='1m'; this.form.submit();">1M</button>
        </div>
        <button type="submit" class="btn">
            <svg class="icon" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
            </svg>
            Show
        </button>
    </form>

    <div class="chart-container">
        <canvas id="latencyChart"></canvas>
    </div>
    <div style="margin-top:10px;color:rgba(255,255,255,0.65);font-size:12px;">
        Tip: double-click pada chart untuk mengaktifkan / mematikan mode zoom & pan. Saat aktif, scroll/pinch untuk zoom dan drag untuk geser.
    </div>
</div>

<script>
    const historyData = {{.JSONHistoryData}};
    const selectedUrlId = window.dashboardChartUrlId || {{.SelectedURLID}};
    const chartRange = window.dashboardChartRange || "{{or .ChartRange "1d"}}";
    initChart(historyData, selectedUrlId, chartRange);
</script>

{{end}}